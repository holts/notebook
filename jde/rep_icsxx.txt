CREATE PROCEDURE [dbo].[rep_icsxx]    AS

-- =============================================
-- Author:		<holts>
-- Create date: <2015/04/22>
-- Description:	Income Statement schedule
-- =============================================

Declare @Comp nchar(5), @Period nchar(10)
set @Comp = '00276'
select  @Period = Period  from period where  company=@Comp  and fromdate<=getdate()  and todate>=getdate()


if not exists (select * from period where company=@Comp and period=@period and status<>'P')
   begin
     print '不存在这个结算区间'
     return
   end

Declare @startdate datetime, @enddate datetime, @Lperiod nchar(10)

select @startdate=Fromdate, @enddate=Todate,@lperiod=LastPeriod
  from period where company=@Comp and period=@period

select  'R002.00' as ItemNo,  'Advertising Media          '   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('AMM','AMR','AM8','AMO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('AMM','AMR','AM8','AMO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('AMM','AMR','AM8','AMO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('AMM','AMR','AM8','AMO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('AMM','AMR','AM8','AMO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('AMM','AMR','AM8','AMO') ),0)    as LastYTD

into #icsxx


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
values( 'R001.00','Advertising', 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00 ,0.00)
 
 insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R003.00' as ItemNo,  'Advertising Production'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('APM','APR','AP8','APO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('APM','APR','AP8','APO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('APM','APR','AP8','APO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('APM','APR','AP8','APO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('APM','APR','AP8','APO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('APM','APR','AP8','APO') ),0)    as LastYTD
 

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R004.00' as ItemNo,  'Market Research'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('ARM','ARR','AR8','ARO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('ARM','ARR','AR8','ARO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('ARM','ARR','AR8','ARO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('ARM','ARR','AR8','ARO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('ARM','ARR','AR8','ARO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('ARM','ARR','AR8','ARO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R005.00' as ItemNo,  'POS Materials'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('AAM','AAR','AA8','AAO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('AAM','AAR','AA8','AAO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('AAM','AAR','AA8','AAO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('AAM','AAR','AA8','AAO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('AAM','AAR','AA8','AAO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('AAM','AAR','AA8','AAO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R006.00' as ItemNo,  'Billboard'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('ABM','ABR','AB8','ABO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('ABM','ABR','AB8','ABO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('ABM','ABR','AB8','ABO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('ABM','ABR','AB8','ABO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('ABM','ABR','AB8','ABO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('ABM','ABR','AB8','ABO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R007.00' as ItemNo,  'New Product Development'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SRM','SRR','SR8','SRO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SRM','SRR','SR8','SRO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SRM','SRR','SR8','SRO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SRM','SRR','SR8','SRO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SRM','SRR','SR8','SRO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SRM','SRR','SR8','SRO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select 'R008.00','Sub-total', sum(ThisMM),0.00, sum(Budget), sum(YTD),0.00, sum(BudgetYTD), sum(LastMM),sum(LastYTD)
 from #icsxx where itemno in ('R002.00','R003.00','R004.00','R005.00','R006.00','R007.00')


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
values ( 'R009.00','Promotion', 0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00 )

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R010.00' as ItemNo,  'Display Allowance'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PAM','PAR','PA8','PAO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PAM','PAR','PA8','PAO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PAM','PAR','PA8','PAO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PAM','PAR','PA8','PAO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PAM','PAR','PA8','PAO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PAM','PAR','PA8','PAO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R011.00' as ItemNo,  'Demonstration'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PDM','PDR','PD8','PDO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PDM','PDR','PD8','PDO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PDM','PDR','PD8','PDO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PDM','PDR','PD8','PDO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PDM','PDR','PD8','PDO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PDM','PDR','PD8','PDO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R012.00' as ItemNo,  'Incentive Rebates'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PRM','PRR','PR8','PRO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PRM','PRR','PR8','PRO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PRM','PRR','PR8','PRO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PRM','PRR','PR8','PRO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PRM','PRR','PR8','PRO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PRM','PRR','PR8','PRO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R013.00' as ItemNo,  'Samples'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PFM','PFR','PF8','PFO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PFM','PFR','PF8','PFO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PFM','PFR','PF8','PFO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PFM','PFR','PF8','PFO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PFM','PFR','PF8','PFO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PFM','PFR','PF8','PFO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R014.00' as ItemNo,  'Chainstore Promotion'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PSM','PSR','PS8','PSO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PSM','PSR','PS8','PSO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PSM','PSR','PS8','PSO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PSM','PSR','PS8','PSO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PSM','PSR','PS8','PSO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PSM','PSR','PS8','PSO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R015.00' as ItemNo,  'General Trade Promotions'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PGM','PGR','PG8','PGO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PGM','PGR','PG8','PGO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PGM','PGR','PG8','PGO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PGM','PGR','PG8','PGO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PGM','PGR','PG8','PGO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PGM','PGR','PG8','PGO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R016.00' as ItemNo,  'POS Materials'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PPM','PPR','PP8','PMO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PPM','PPR','PP8','PMO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PPM','PPR','PP8','PMO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PPM','PPR','PP8','PMO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PPM','PPR','PP8','PMO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PPM','PPR','PP8','PMO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R017.00' as ItemNo,  'Consumer Promotion'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PCM','PCR','PC8','PCO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PCM','PCR','PC8','PCO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PCM','PCR','PC8','PCO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PCM','PCR','PC8','PCO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PCM','PCR','PC8','PCO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PCM','PCR','PC8','PCO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R018.00' as ItemNo,  'Listing Fee'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('PLM','PLR','PL8','PLO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('PLM','PLR','PL8','PLO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('PLM','PLR','PL8','PLO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('PLM','PLR','PL8','PLO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('PLM','PLR','PL8','PLO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('PLM','PLR','PL8','PLO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select 'R019.00','Sub-total', sum(ThisMM),0.00, sum(Budget), sum(YTD),0.00, sum(BudgetYTD), sum(LastMM),sum(LastYTD)
 from #icsxx where itemno in ('R010.00','R011.00','R012.00','R013.00','R014.00','R015.00','R016.00','R017.00','R018.00')

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
values ( 'R020.00','Selling', 0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00 )

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R021.00' as ItemNo,  'Salaries'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SSM','SSR','SS8','SSO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SSM','SSR','SS8','SSO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SSM','SSR','SS8','SSO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SSM','SSR','SS8','SSO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SSM','SSR','SS8','SSO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SSM','SSR','SS8','SSO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R022.00' as ItemNo,  'Commission'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SCM','SCR','SC8','SCO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SCM','SCR','SC8','SCO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SCM','SCR','SC8','SCO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SCM','SCR','SC8','SCO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SCM','SCR','SC8','SCO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SCM','SCR','SC8','SCO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R023.00' as ItemNo,  'Travelling Expense'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('STM','STR','ST8','STO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('STM','STR','ST8','STO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('STM','STR','ST8','STO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('STM','STR','ST8','STO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('STM','STR','ST8','STO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('STM','STR','ST8','STO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R024.00' as ItemNo,  'Transportation Fee'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SFM','SFR','SF8','SFO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SFM','SFR','SF8','SFO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SFM','SFR','SF8','SFO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SFM','SFR','SF8','SFO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SFM','SFR','SF8','SFO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SFM','SFR','SF8','SFO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R025.00' as ItemNo,  'Repair & Maintenance'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SNM','SNR','SN8','SNO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SNM','SNR','SN8','SNO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SNM','SNR','SN8','SNO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SNM','SNR','SN8','SNO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SNM','SNR','SN8','SNO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SNM','SNR','SN8','SNO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R026.00' as ItemNo,  'Transportation Allowance'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SLM','SLR','SL8','SLO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SLM','SLR','SL8','SLO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SLM','SLR','SL8','SLO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SLM','SLR','SL8','SLO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SLM','SLR','SL8','SLO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SLM','SLR','SL8','SLO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R027.00' as ItemNo,  'Storages'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('RTM','RTR','RT8','RTO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('RTM','RTR','RT8','RTO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('RTM','RTR','RT8','RTO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('RTM','RTR','RT8','RTO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('RTM','RTR','RT8','RTO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('RTM','RTR','RT8','RTO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R028.00' as ItemNo,  'Warehouse Services'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SWM','SWR','SW8','SWO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SWM','SWR','SW8','SWO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SWM','SWR','SW8','SWO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SWM','SWR','SW8','SWO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SWM','SWR','SW8','SWO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SWM','SWR','SW8','SWO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R029.00' as ItemNo,  'Delivery Charges'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SDM','SDR','SD8','SDO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SDM','SDR','SD8','SDO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SDM','SDR','SD8','SDO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SDM','SDR','SD8','SDO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SDM','SDR','SD8','SDO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SDM','SDR','SD8','SDO') ),0)    as LastYTD


insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R030.00' as ItemNo,  'Bad Debts Reserve'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SBM','SBR','SB8','SBO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SBM','SBR','SB8','SBO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SBM','SBR','SB8','SBO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SBM','SBR','SB8','SBO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SBM','SBR','SB8','SBO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SBM','SBR','SB8','SBO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select  'R031.00' as ItemNo,  'Marketing Service Fees'   as  ItemDesc, 
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
         left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='AA' and   mcrp01 in ('SAL','COR')  and  gmr020 in ('SMM','SMR','SM8','SMO')  ), 0)   as ThisMM,    cast(0.00 as float)  as RatioMM,
  isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end) * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
          left join f0006  on   gmco=mcco and gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
          and gblt='BA' and  mcrp01  in ('SAL','COR') and gmr020 in ('SMM','SMR','SM8','SMO') ), 0 )  as Budget, 
   isnull( ( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
               left join f0006  on   gmco=mcco and gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='AA' and  mcrp01 in ('SAL','COR') and  gmr020 in ('SMM','SMR','SM8','SMO') ) ,0)   as YTD,    cast(0.00 as float)   as RatioYTD,  
   isnull(( select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (1.00 )  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
            and gblt='BA' and mcrp01 in ('SAL','COR') and  gmr020 in ('SMM','SMR','SM8','SMO') ),0 )    as BudgetYTD, 
    isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN03  when SUBSTRING(@LPeriod,5,2)='04' then GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN05  when SUBSTRING(@LPeriod,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@LPeriod,5,2)='08' then GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN09  when SUBSTRING(@LPeriod,5,2)='10' then GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN11  when SUBSTRING(@LPeriod,5,2)='12' then GBAN12   else 0 end)  * (1.00)
      from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
            left join f0006  on  gmco=mcco and  gmmcu=mcmcu
       where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
          and gblt='AA' and  mcrp01 in ('SAL', 'COR') and  gmr020 in ('SMM','SMR','SM8','SMO') ),0 )   as  LastMM, 
   isnull(( select SUM(case when SUBSTRING(@LPeriod,5,2)='01' then GBAN01  when SUBSTRING(@LPeriod,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@LPeriod,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@LPeriod,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@LPeriod,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@LPeriod,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@LPeriod,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@LPeriod,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@LPeriod,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@LPeriod,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@LPeriod,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@LPeriod,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * ( 1.00)  from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
              left join f0006  on  gmco=mcco and  gmmcu=mcmcu
         where  gbco=@Comp  and gbctry=substring(@LPeriod,1,2) and  gbfy=substring(@LPeriod,3, 2) 
            and gblt='AA' and   mcrp01 in ('SAL','COR') and  gmr020 in ('SMM','SMR','SM8','SMO') ),0)    as LastYTD

insert #icsxx ( ItemNo, ItemDesc, ThisMM, RatioMM, Budget, YTD, RatioYTD, BudgetYTD, LastMM,  LastYTD)
select 'R032.00','Sub-total', sum(ThisMM),0.00, sum(Budget), sum(YTD),0.00, sum(BudgetYTD), sum(LastMM),sum(LastYTD)
 from #icsxx where itemno in ('R021.00','R022.00','R023.00','R024.00','R025.00','R026.00','R027.00','R028.00','R029.00','R030.00','R031.00')



------------------------------------------------------------------------------- 
update #icsxx  set  RatioMM=  100.00 *  ThisMM / (   
          select  SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN03  when SUBSTRING(@Period,5,2)='04' then GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN05  when SUBSTRING(@Period,5,2)='06' then GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN07  when SUBSTRING(@Period,5,2)='08' then GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN09  when SUBSTRING(@Period,5,2)='10' then GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN11  when SUBSTRING(@Period,5,2)='12' then GBAN12   else 0 end)  * (-1.00)
                 from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
                   left join f0006  on   gmco=mcco and gmmcu=mcmcu
              where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
                  and gblt='AA' and gmr018 in ('PGS' ,'PTD', 'PDA', 'PRA')   and mcrp01 in ('SAL','COR')              ),
   RatioYTD=  100.00 * YTD/(
         select SUM(case when SUBSTRING(@Period,5,2)='01' then GBAN01  when SUBSTRING(@Period,5,2)='02' then GBAN01+GBAN02 
           when SUBSTRING(@Period,5,2)='03' then GBAN01+GBAN02+GBAN03 
           when SUBSTRING(@Period,5,2)='04' then GBAN01+GBAN02+GBAN03+GBAN04 
           when SUBSTRING(@Period,5,2)='05' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05 
           when SUBSTRING(@Period,5,2)='06' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06 
           when SUBSTRING(@Period,5,2)='07' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07  
           when SUBSTRING(@Period,5,2)='08' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08 
           when SUBSTRING(@Period,5,2)='09' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09
           when SUBSTRING(@Period,5,2)='10' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10 
           when SUBSTRING(@Period,5,2)='11' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11  
           when SUBSTRING(@Period,5,2)='12' then GBAN01+GBAN02+GBAN03+GBAN04+GBAN05+GBAN06+GBAN07+GBAN08+GBAN09+GBAN10+GBAN11+GBAN12 
            else 0 end)   * (-1.00)
               from f0902 left join f0901 on  gbco=gmco and gbaid=gmaid
                   left join f0006  on   gmco=mcco and gmmcu=mcmcu
              where  gbco=@Comp  and gbctry=substring(@Period,1,2) and  gbfy=substring(@Period,3, 2) 
                  and gblt='AA' and gmr018 in ('PGS' ,'PTD', 'PDA', 'PRA')   and mcrp01 in ('SAL','COR')        
        )


-------------------------------------

delete icmtl  where comp=@Comp and perid=@period  and ver='ICSXX'

insert icmtl( perid,comp, ver, itemno, itemdesc, thismm,ratiomm,budgetmm,ytd,ratioytd,budgetytd,lastmm,lastytd)
select   @period,@comp, 'ICSXX' , itemno,itemdesc,thismm,ratiomm,budget,ytd,ratioytd,budgetytd,lastmm,lastytd
 from #icsxx  order by itemno
GO

